<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Calibra√ß√£o Completa - SOLICAL1</title>
  
  <!-- Bibliotecas para exporta√ß√£o -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
  <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
  
  <style>
    /* Vari√°veis CSS */
    :root {
      --primary: #2c3e50;
      --primary-light: #34495e;
      --secondary: #3498db;
      --success: #27ae60;
      --warning: #f39c12;
      --danger: #e74c3c;
      --info: #3498db;
      --light: #ecf0f1;
      --dark: #2c3e50;
      --border: #bdc3c7;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --radius: 8px;
    }

    .dark-theme {
      --primary: #1a1a2e;
      --primary-light: #16213e;
      --secondary: #0f3460;
      --success: #1e5128;
      --warning: #ff9f29;
      --danger: #d92027;
      --info: #1a73e8;
      --light: #2c2c2c;
      --dark: #f5f5f5;
      --border: #404040;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }

    .dark-theme body {
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
    }

    .dark-theme .container {
      background: var(--primary);
    }

    /* Header */
    header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 30px;
      text-align: center;
      position: relative;
    }

    .dark-theme header {
      background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 100%);
    }

    h1 {
      font-size: 2.5rem;
      margin-bottom: 10px;
      font-weight: 300;
    }

    .subtitle {
      font-size: 1.1rem;
      opacity: 0.9;
      margin-bottom: 20px;
    }

    .header-controls {
      position: absolute;
      top: 20px;
      right: 20px;
      display: flex;
      gap: 10px;
    }

    .btn-icon {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
      transition: background 0.3s;
    }

    .btn-icon:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    /* Sistema de abas */
    .tabs-container {
      background: var(--light);
      border-bottom: 1px solid var(--border);
    }

    .dark-theme .tabs-container {
      background: var(--primary-light);
    }

    .tabs {
      display: flex;
      overflow-x: auto;
      padding: 0 20px;
    }

    .tab-btn {
      padding: 15px 30px;
      background: none;
      border: none;
      border-bottom: 3px solid transparent;
      color: var(--primary);
      font-weight: 600;
      cursor: pointer;
      white-space: nowrap;
      transition: all 0.3s;
    }

    .dark-theme .tab-btn {
      color: var(--dark);
    }

    .tab-btn:hover {
      background: rgba(52, 152, 219, 0.1);
    }

    .dark-theme .tab-btn:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .tab-btn.active {
      border-bottom: 3px solid var(--secondary);
      color: var(--secondary);
    }

    /* Conte√∫do das abas */
    .tab-content {
      padding: 30px;
      display: none;
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.5s;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Layout em grid para os c√°lculos */
    .calculations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      margin-bottom: 40px;
    }

    .calculation-card {
      background: white;
      border-radius: var(--radius);
      padding: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .dark-theme .calculation-card {
      background: var(--primary-light);
      border-color: var(--border);
    }

    .card-header {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--secondary);
    }

    .card-icon {
      width: 50px;
      height: 50px;
      background: var(--secondary);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
    }

    .card-title {
      font-size: 1.3rem;
      color: var(--primary);
    }

    .dark-theme .card-title {
      color: var(--dark);
    }

    /* Formul√°rios */
    .form-group {
      margin-bottom: 20px;
    }

    .form-row {
      display: flex;
      gap: 15px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .form-col {
      flex: 1;
      min-width: 200px;
    }

    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: var(--primary);
    }

    .dark-theme label {
      color: var(--dark);
    }

    .unit {
      color: #666;
      font-weight: normal;
      font-size: 0.9rem;
    }

    .dark-theme .unit {
      color: #aaa;
    }

    input[type="number"] {
      width: 100%;
      padding: 12px 15px;
      border: 1px solid var(--border);
      border-radius: 6px;
      font-size: 1rem;
      transition: border 0.3s, box-shadow 0.3s;
    }

    input[type="number"]:focus {
      outline: none;
      border-color: var(--secondary);
      box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }

    .dark-theme input[type="number"] {
      background: var(--primary);
      color: var(--dark);
      border-color: var(--border);
    }

    /* Bot√µes */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      transition: all 0.3s;
      min-width: 160px;
    }

    .btn-primary {
      background: var(--secondary);
      color: white;
    }

    .btn-primary:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-success:hover {
      background: #219653;
      transform: translateY(-2px);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #c0392b;
      transform: translateY(-2px);
    }

    .btn-info {
      background: var(--info);
      color: white;
    }

    .btn-info:hover {
      background: #2874a6;
      transform: translateY(-2px);
    }

    .btn-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 20px;
    }

    /* Resultados */
    .result-box {
      margin-top: 25px;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: var(--radius);
      border-left: 5px solid var(--secondary);
    }

    .dark-theme .result-box {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    }

    .result-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--primary);
    }

    .dark-theme .result-title {
      color: var(--dark);
    }

    .result-value {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--secondary);
      margin: 10px 0;
    }

    .result-details {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .detail-item {
      padding: 15px;
      background: white;
      border-radius: 6px;
      border: 1px solid var(--border);
    }

    .dark-theme .detail-item {
      background: var(--primary);
    }

    .detail-label {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 5px;
    }

    .dark-theme .detail-label {
      color: #aaa;
    }

    .detail-value {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--primary);
    }

    .dark-theme .detail-value {
      color: var(--dark);
    }

    /* Relat√≥rios - Tabela profissional */
    .reports-section {
      margin-top: 40px;
      padding-top: 30px;
      border-top: 2px solid var(--border);
    }

    .reports-table-container {
      overflow-x: auto;
      margin: 20px 0;
      background: white;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }

    .dark-theme .reports-table-container {
      background: var(--primary-light);
    }

    .reports-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1000px;
    }

    .reports-table th {
      background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
      color: white;
      padding: 15px;
      text-align: left;
      font-weight: 600;
      border-right: 1px solid rgba(255, 255, 255, 0.1);
    }

    .reports-table th:last-child {
      border-right: none;
    }

    .reports-table td {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border);
      color: var(--primary);
    }

    .dark-theme .reports-table td {
      color: var(--dark);
    }

    .reports-table tr:nth-child(even) {
      background: rgba(0, 0, 0, 0.02);
    }

    .dark-theme .reports-table tr:nth-child(even) {
      background: rgba(255, 255, 255, 0.05);
    }

    .reports-table tr:hover {
      background: rgba(52, 152, 219, 0.1);
    }

    .error-bad {
      color: var(--danger);
      font-weight: 600;
      background: rgba(231, 76, 60, 0.1);
      padding: 2px 8px;
      border-radius: 4px;
    }

    .warning-medium {
      color: var(--warning);
      font-weight: 600;
      background: rgba(243, 156, 18, 0.1);
      padding: 2px 8px;
      border-radius: 4px;
    }

    .success-good {
      color: var(--success);
      font-weight: 600;
      background: rgba(39, 174, 96, 0.1);
      padding: 2px 8px;
      border-radius: 4px;
    }

    .excellent {
      color: #27ae60;
      font-weight: 600;
      background: rgba(39, 174, 96, 0.2);
      padding: 2px 8px;
      border-radius: 4px;
    }

    /* Painel de relat√≥rios */
    .reports-panel {
      margin-top: 40px;
    }

    .report-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      padding: 20px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      border-radius: var(--radius);
    }

    .dark-theme .report-actions {
      background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
    }

    /* Mensagens */
    .message {
      padding: 15px 20px;
      border-radius: var(--radius);
      margin: 20px 0;
      display: none;
      animation: slideIn 0.3s;
    }

    @keyframes slideIn {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }

    .message.success {
      background: rgba(39, 174, 96, 0.1);
      border-left: 5px solid var(--success);
      color: var(--success);
    }

    .message.error {
      background: rgba(231, 76, 60, 0.1);
      border-left: 5px solid var(--danger);
      color: var(--danger);
    }

    .message.info {
      background: rgba(52, 152, 219, 0.1);
      border-left: 5px solid var(--info);
      color: var(--info);
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 30px;
      background: var(--primary);
      color: white;
      margin-top: 40px;
    }

    .dark-theme footer {
      background: var(--primary-light);
    }

    /* Responsividade */
    @media (max-width: 768px) {
      .calculations-grid {
        grid-template-columns: 1fr;
      }
      
      .form-row {
        flex-direction: column;
      }
      
      .form-col {
        min-width: 100%;
      }
      
      .btn {
        min-width: 100%;
      }
      
      .header-controls {
        position: static;
        justify-content: center;
        margin-top: 20px;
      }
      
      .tabs {
        padding: 0 10px;
      }
      
      .tab-btn {
        padding: 12px 15px;
        font-size: 0.9rem;
      }
    }

    @media print {
      .no-print {
        display: none !important;
      }
      
      .container {
        box-shadow: none;
      }
      
      .reports-table {
        min-width: auto;
      }
    }

    /* Explica√ß√µes */
    .explanation {
      margin-top: 30px;
      padding: 20px;
      background: rgba(0, 0, 0, 0.03);
      border-radius: var(--radius);
      border-left: 4px solid var(--secondary);
    }

    .dark-theme .explanation {
      background: rgba(255, 255, 255, 0.05);
    }

    .explanation h4 {
      margin-bottom: 15px;
      color: var(--secondary);
    }

    .formula {
      font-family: 'Courier New', monospace;
      background: rgba(0, 0, 0, 0.05);
      padding: 10px;
      border-radius: 4px;
      margin: 10px 0;
      border-left: 3px solid var(--secondary);
    }

    .dark-theme .formula {
      background: rgba(255, 255, 255, 0.05);
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Calculadora de Calibra√ß√£o Completa</h1>
      <p class="subtitle">Sistema para c√°lculo de fator K com cabo padr√£o e calibra√ß√£o com tac√¥metro</p>
      <div class="header-controls">
        <button class="btn-icon" id="themeToggle" title="Alternar tema">üåô</button>
        <button class="btn-icon" id="helpToggle" title="Ajuda">?</button>
        <button class="btn-icon" id="printToggle" title="Imprimir">üñ®Ô∏è</button>
      </div>
    </header>
    
    <div class="tabs-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="cabo-padrao">Cabo Padr√£o</button>
        <button class="tab-btn" data-tab="calibracao-tacometro">Calibra√ß√£o com Tac√¥metro</button>
        <button class="tab-btn" data-tab="relatorios">Relat√≥rios</button>
        <button class="tab-btn" data-tab="historico">Hist√≥rico</button>
      </div>
    </div>
    
    <!-- Mensagens -->
    <div class="message" id="message"></div>
    
    <!-- Aba 1: Cabo Padr√£o -->
    <div id="cabo-padrao" class="tab-content active">
      <div class="calculations-grid">
        <!-- C√°lculo do Fator K com Cabo Padr√£o -->
        <div class="calculation-card">
          <div class="card-header">
            <div class="card-icon">K</div>
            <h2 class="card-title">Calcular Fator K com Cabo Padr√£o</h2>
          </div>
          
          <div class="form-group">
            <div class="form-row">
              <div class="form-col">
                <label for="valorPadrao">Comprimento Real do Cabo Padr√£o <span class="unit">(metros)</span></label>
                <input type="number" id="valorPadrao" step="0.001" min="0" placeholder="Ex: 100.000">
              </div>
              <div class="form-col">
                <label for="valorContador">Leitura do Contador <span class="unit">(unidades)</span></label>
                <input type="number" id="valorContador" step="0.001" min="0.001" placeholder="Ex: 98.500">
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button class="btn btn-primary" id="calcularFatorK">
              <span>üßÆ</span> Calcular Fator K
            </button>
            <button class="btn btn-danger" id="limparFatorK">
              <span>üóëÔ∏è</span> Limpar
            </button>
          </div>
          
          <div class="result-box" id="resultadoFatorK" style="display: none;">
            <div class="result-title">Resultado do Fator K</div>
            <div class="result-value" id="valorFatorK"></div>
            <div class="result-details">
              <div class="detail-item">
                <div class="detail-label">Fator K Calculado</div>
                <div class="detail-value" id="fatorKValor"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Comprimento Real</div>
                <div class="detail-value" id="comprimentoReal"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Leitura do Contador</div>
                <div class="detail-value" id="leituraContador"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Precis√£o</div>
                <div class="detail-value" id="precisaoFatorK"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Aplicar Fator Corrigido -->
        <div class="calculation-card">
          <div class="card-header">
            <div class="card-icon">üìê</div>
            <h2 class="card-title">Aplicar Fator Corrigido</h2>
          </div>
          
          <div class="form-group">
            <div class="form-row">
              <div class="form-col">
                <label for="contadorFatorCorrigido">Leitura do Contador <span class="unit">(unidades)</span></label>
                <input type="number" id="contadorFatorCorrigido" step="0.001" min="0.001" placeholder="Ex: 150.000">
              </div>
              <div class="form-col">
                <label for="fatorCorrigidoInput">Fator K Corrigido</label>
                <input type="number" id="fatorCorrigidoInput" step="0.000001" min="0" placeholder="Ex: 1.015228">
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button class="btn btn-primary" id="aplicarFatorCorrigido">
              <span>üîß</span> Aplicar Fator Corrigido
            </button>
          </div>
          
          <div class="result-box" id="resultadoFatorCorrigido" style="display: none;">
            <div class="result-title">Resultado com Fator Corrigido</div>
            <div class="result-value" id="metrosCorrigidos"></div>
            <div class="result-details">
              <div class="detail-item">
                <div class="detail-label">Comprimento Calculado</div>
                <div class="detail-value" id="comprimentoCalculado"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Fator K Aplicado</div>
                <div class="detail-value" id="fatorAplicado"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Precis√£o Estimada</div>
                <div class="detail-value" id="precisaoCorrigida"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Calcular Fator para Metros Desejados -->
        <div class="calculation-card">
          <div class="card-header">
            <div class="card-icon">üéØ</div>
            <h2 class="card-title">Calcular Fator para Metros Desejados</h2>
          </div>
          
          <div class="form-group">
            <div class="form-row">
              <div class="form-col">
                <label for="contadorDesejado">Leitura do Contador <span class="unit">(unidades)</span></label>
                <input type="number" id="contadorDesejado" step="0.001" min="0.001" placeholder="Ex: 150.000">
              </div>
              <div class="form-col">
                <label for="metrosDesejados">Metros Desejados <span class="unit">(m)</span></label>
                <input type="number" id="metrosDesejados" step="0.001" min="0" placeholder="Ex: 152.500">
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button class="btn btn-primary" id="calcularFatorDesejado">
              <span>üîß</span> Calcular Fator Necess√°rio
            </button>
          </div>
          
          <div class="result-box" id="resultadoFatorNecessario" style="display: none;">
            <div class="result-title">Fator K Necess√°rio</div>
            <div class="result-value" id="fatorNecessario"></div>
            <div class="result-details">
              <div class="detail-item">
                <div class="detail-label">Metros Alvo</div>
                <div class="detail-value" id="metrosAlvo"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Contador Base</div>
                <div class="detail-value" id="contadorBase"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="explanation">
        <h4>üìö Explica√ß√£o do C√°lculo com Cabo Padr√£o</h4>
        <p><strong>Fator K (Coeficiente de Calibra√ß√£o):</strong></p>
        <p class="formula">Fator K = Comprimento Real do Cabo Padr√£o √∑ Leitura do Contador</p>
        <p>O Fator K √© usado para converter a leitura do contador em metros reais. Se o cabo padr√£o tem 100m e o contador l√™ 98.5, o fator K √© 100 √∑ 98.5 = 1.015228.</p>
        
        <p><strong>Aplicar Fator Corrigido:</strong></p>
        <p class="formula">Metros Corrigidos = Leitura do Contador √ó Fator K Corrigido</p>
        <p>Use esta f√≥rmula para calcular o comprimento real quando j√° conhece o fator K correto.</p>
        
        <p><strong>Calcular Fator para Metros Desejados:</strong></p>
        <p class="formula">Fator Necess√°rio = Metros Desejados √∑ Leitura do Contador</p>
        <p>Calcule qual fator K √© necess√°rio para que o contador mostre uma medida espec√≠fica.</p>
      </div>
    </div>
    
    <!-- Aba 2: Calibra√ß√£o com Tac√¥metro -->
    <div id="calibracao-tacometro" class="tab-content">
      <div class="calculations-grid">
        <!-- Calibrar M√°quina usando Tac√¥metro -->
        <div class="calculation-card">
          <div class="card-header">
            <div class="card-icon">‚öôÔ∏è</div>
            <h2 class="card-title">Calibrar M√°quina usando Tac√¥metro</h2>
          </div>
          
          <div class="form-group">
            <div class="form-row">
              <div class="form-col">
                <label for="fatorAntigoMaquina">Fator Antigo da M√°quina</label>
                <input type="number" id="fatorAntigoMaquina" step="0.000001" min="0.000001" placeholder="Ex: 1.000000">
              </div>
              <div class="form-col">
                <label for="metrosTacometroPadrao">Medi√ß√£o do Tac√¥metro <span class="unit">(padr√£o)</span></label>
                <input type="number" id="metrosTacometroPadrao" step="0.001" min="0.001" placeholder="Ex: 100.000">
              </div>
              <div class="form-col">
                <label for="metrosMaquinaMedido">Medi√ß√£o da M√°quina <span class="unit">(medido)</span></label>
                <input type="number" id="metrosMaquinaMedido" step="0.001" min="0.001" placeholder="Ex: 98.500">
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button class="btn btn-primary" id="calibrarMaquinaTacometro">
              <span>üîß</span> Calibrar M√°quina
            </button>
            <button class="btn btn-success" id="adicionarCalibracaoRelatorio">
              <span>‚ûï</span> Adicionar ao Relat√≥rio
            </button>
          </div>
          
          <div class="result-box" id="resultadoCalibracaoTacometro" style="display: none;">
            <div class="result-title">Resultado da Calibra√ß√£o</div>
            <div class="result-value" id="novoFatorMaquina"></div>
            <div class="result-details">
              <div class="detail-item">
                <div class="detail-label">Fator Antigo</div>
                <div class="detail-value" id="fatorAntigoValor"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Fator Corrigido</div>
                <div class="detail-value" id="fatorCorrigidoTacometro"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Metros com Fator Antigo</div>
                <div class="detail-value" id="metrosFatorAntigo"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Metros com Fator Corrigido</div>
                <div class="detail-value" id="metrosFatorCorrigido"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Erro com Fator Antigo</div>
                <div class="detail-value" id="erroFatorAntigo"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Erro com Fator Corrigido</div>
                <div class="detail-value" id="erroFatorCorrigido"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Melhoria</div>
                <div class="detail-value" id="melhoriaCalibracao"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Status</div>
                <div class="detail-value" id="statusCalibracao"></div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Simular com Fator Desejado -->
        <div class="calculation-card">
          <div class="card-header">
            <div class="card-icon">üß™</div>
            <h2 class="card-title">Simular com Fator Desejado</h2>
          </div>
          
          <div class="form-group">
            <div class="form-row">
              <div class="form-col">
                <label for="fatorDesejadoTeste">Fator Desejado para Teste</label>
                <input type="number" id="fatorDesejadoTeste" step="0.000001" min="0" placeholder="Ex: 1.020000">
              </div>
              <div class="form-col">
                <label for="tacometroTeste">Medi√ß√£o do Tac√¥metro <span class="unit">(m)</span></label>
                <input type="number" id="tacometroTeste" step="0.001" min="0.001" placeholder="Ex: 100.000">
              </div>
              <div class="form-col">
                <label for="fatorAtualMaquina">Fator Atual da M√°quina</label>
                <input type="number" id="fatorAtualMaquina" step="0.000001" min="0.000001" placeholder="Ex: 1.000000">
              </div>
            </div>
          </div>
          
          <div class="btn-group">
            <button class="btn btn-primary" id="simularFatorDesejado">
              <span>üßÆ</span> Simular Leitura
            </button>
          </div>
          
          <div class="result-box" id="resultadoSimulacaoTacometro" style="display: none;">
            <div class="result-title">Resultado da Simula√ß√£o</div>
            <div class="result-value" id="metrosSimuladosTacometro"></div>
            <div class="result-details">
              <div class="detail-item">
                <div class="detail-label">Medi√ß√£o Calculada</div>
                <div class="detail-value" id="medicaoCalculada"></div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Erro Simulado</div>
                <div class="detail-value" id="erroSimulado"></div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="explanation">
        <h4>üìö Explica√ß√£o da Calibra√ß√£o com Tac√¥metro</h4>
        <p><strong>C√°lculo do Novo Fator:</strong></p>
        <p class="formula">Novo Fator = (Fator Antigo √ó Medi√ß√£o do Tac√¥metro) √∑ Medi√ß√£o da M√°quina</p>
        <p>Esta f√≥rmula recalibra a m√°quina para que ela mostre a mesma medida que o tac√¥metro (padr√£o).</p>
        
        <p><strong>C√°lculo do Erro:</strong></p>
        <p class="formula">Erro = |(Medi√ß√£o da M√°quina - Medi√ß√£o do Tac√¥metro) √∑ Medi√ß√£o do Tac√¥metro| √ó 100%</p>
        <p>Mostra a diferen√ßa percentual entre a medi√ß√£o da m√°quina e o padr√£o.</p>
        
        <p><strong>Simula√ß√£o com Fator Desejado:</strong></p>
        <p class="formula">Medi√ß√£o Calculada = (Fator Desejado √ó Medi√ß√£o do Tac√¥metro) √∑ Fator Atual</p>
        <p>Simula qual medi√ß√£o a m√°quina mostraria se fosse configurada com um fator espec√≠fico.</p>
      </div>
    </div>
    
    <!-- Aba 3: Relat√≥rios -->
    <div id="relatorios" class="tab-content">
      <div class="reports-panel">
        <h2 style="margin-bottom: 20px; color: var(--primary);">Relat√≥rios de Calibra√ß√£o</h2>
        
        <div class="report-actions">
          <button class="btn btn-success" id="gerarRelatorioCompleto">
            <span>üìä</span> Gerar Relat√≥rio Completo
          </button>
          <button class="btn btn-info" id="exportarExcel">
            <span>üìà</span> Exportar para Excel
          </button>
          <button class="btn btn-danger" id="exportarPDF">
            <span>üìÑ</span> Exportar para PDF
          </button>
          <button class="btn btn-danger" id="limparRelatorios">
            <span>üóëÔ∏è</span> Limpar Relat√≥rios
          </button>
        </div>
        
        <div class="reports-section">
          <h3 style="margin-bottom: 20px; color: var(--primary);">Tabela de Calibra√ß√µes com Tac√¥metro</h3>
          <div class="reports-table-container">
            <table class="reports-table" id="tabelaRelatorios">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Tac√¥metro (m)</th>
                  <th>Fator Antigo</th>
                  <th>Medi√ß√£o Antiga (m)</th>
                  <th>Erro Antigo (%)</th>
                  <th>Fator Corrigido</th>
                  <th>Medi√ß√£o Corrigida (m)</th>
                  <th>Erro Corrigido (%)</th>
                  <th>Melhoria (%)</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody id="corpoTabelaRelatorios">
                <tr id="linhaSemRelatorios">
                  <td colspan="10" style="text-align: center; padding: 40px; color: #666;">
                    Nenhuma calibra√ß√£o no relat√≥rio. Calibre uma m√°quina e clique em "Adicionar ao Relat√≥rio".
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="reports-section">
          <h3 style="margin-bottom: 20px; color: var(--primary);">Relat√≥rios de C√°lculo com Cabo Padr√£o</h3>
          <div class="reports-table-container">
            <table class="reports-table" id="tabelaCaboPadrao">
              <thead>
                <tr>
                  <th>Data</th>
                  <th>Cabo Padr√£o (m)</th>
                  <th>Leitura Contador</th>
                  <th>Fator K Calculado</th>
                  <th>Metros Calculados</th>
                  <th>Erro (%)</th>
                  <th>Tipo de C√°lculo</th>
                </tr>
              </thead>
              <tbody id="corpoTabelaCaboPadrao">
                <tr id="linhaSemCaboPadrao">
                  <td colspan="7" style="text-align: center; padding: 40px; color: #666;">
                    Nenhum c√°lculo com cabo padr√£o registrado.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        
        <div class="reports-section">
          <h3 style="margin-bottom: 20px; color: var(--primary);">Resumo Estat√≠stico</h3>
          <div class="result-box">
            <div class="result-details" id="resumoEstatistico">
              <div class="detail-item">
                <div class="detail-label">Total de Calibra√ß√µes</div>
                <div class="detail-value" id="totalCalibracoes">0</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Calibra√ß√µes Bem-sucedidas</div>
                <div class="detail-value" id="calibracoesSucesso">0</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">Melhor Melhoria</div>
                <div class="detail-value" id="melhorMelhoria">0%</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">M√©dia de Erro Antigo</div>
                <div class="detail-value" id="mediaErroAntigo">0%</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">M√©dia de Erro Corrigido</div>
                <div class="detail-value" id="mediaErroCorrigido">0%</div>
              </div>
              <div class="detail-item">
                <div class="detail-label">C√°lculos com Cabo Padr√£o</div>
                <div class="detail-value" id="totalCaboPadrao">0</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Aba 4: Hist√≥rico -->
    <div id="historico" class="tab-content">
      <h2 style="margin-bottom: 20px; color: var(--primary);">Hist√≥rico Completo de C√°lculos</h2>
      
      <div class="report-actions">
        <button class="btn btn-info" id="exportarHistoricoExcel">
          <span>üìà</span> Exportar Hist√≥rico para Excel
        </button>
        <button class="btn btn-danger" id="limparHistorico">
          <span>üóëÔ∏è</span> Limpar Hist√≥rico
        </button>
      </div>
      
      <div class="reports-table-container" style="margin-top: 20px;">
        <table class="reports-table">
          <thead>
            <tr>
              <th>Data/Hora</th>
              <th>Tipo</th>
              <th>Valor 1</th>
              <th>Valor 2</th>
              <th>Valor 3</th>
              <th>Fator Calculado</th>
              <th>Resultado</th>
              <th>Erro (%)</th>
            </tr>
          </thead>
          <tbody id="corpoTabelaHistorico">
            <tr id="linhaSemHistorico">
              <td colspan="8" style="text-align: center; padding: 40px; color: #666;">
                Nenhum c√°lculo no hist√≥rico.
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <footer>
      <p>Calculadora de Calibra√ß√£o Completa - SOLICAL1</p>
      <p>Criado por S√©rgio Carqueij√≥ | Vers√£o 4.0 | C√°lculo com Cabo Padr√£o e Tac√¥metro</p>
    </footer>
  </div>

  <script>
    // Sistema principal da calculadora
    class CalculadoraCalibracaoCompleta {
      constructor() {
        this.historico = [];
        this.relatoriosCalibracao = [];
        this.relatoriosCaboPadrao = [];
        this.temaEscuro = false;
        this.calibracaoAtual = null;
        this.init();
      }
      
      init() {
        console.log('Inicializando Calculadora de Calibra√ß√£o Completa...');
        this.carregarDados();
        this.configurarEventos();
        this.atualizarUI();
        this.ativarAba('cabo-padrao');
      }
      
      carregarDados() {
        // Carregar tema
        const tema = localStorage.getItem('temaCalibracaoCompleta');
        if (tema === 'escuro') {
          this.ativarTemaEscuro();
        }
        
        // Carregar hist√≥rico
        const historicoSalvo = localStorage.getItem('historicoCalibracaoCompleta');
        if (historicoSalvo) {
          this.historico = JSON.parse(historicoSalvo);
        }
        
        // Carregar relat√≥rios de calibra√ß√£o
        const relatoriosCalSalvos = localStorage.getItem('relatoriosCalibracaoCompleta');
        if (relatoriosCalSalvos) {
          this.relatoriosCalibracao = JSON.parse(relatoriosCalSalvos);
        }
        
        // Carregar relat√≥rios de cabo padr√£o
        const relatoriosCPSalvos = localStorage.getItem('relatoriosCaboPadraoCompleta');
        if (relatoriosCPSalvos) {
          this.relatoriosCaboPadrao = JSON.parse(relatoriosCPSalvos);
        }
      }
      
      salvarDados() {
        localStorage.setItem('historicoCalibracaoCompleta', JSON.stringify(this.historico));
        localStorage.setItem('relatoriosCalibracaoCompleta', JSON.stringify(this.relatoriosCalibracao));
        localStorage.setItem('relatoriosCaboPadraoCompleta', JSON.stringify(this.relatoriosCaboPadrao));
      }
      
      configurarEventos() {
        // Alternar tema
        document.getElementById('themeToggle').addEventListener('click', () => this.alternarTema());
        
        // Ajuda
        document.getElementById('helpToggle').addEventListener('click', () => this.mostrarAjuda());
        
        // Imprimir
        document.getElementById('printToggle').addEventListener('click', () => window.print());
        
        // Sistema de abas
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            const tabId = e.target.getAttribute('data-tab');
            this.ativarAba(tabId);
          });
        });
        
        // Bot√µes de c√°lculo - Cabo Padr√£o
        document.getElementById('calcularFatorK').addEventListener('click', () => this.calcularFatorKCaboPadrao());
        document.getElementById('limparFatorK').addEventListener('click', () => this.limparCamposCaboPadrao());
        document.getElementById('aplicarFatorCorrigido').addEventListener('click', () => this.aplicarFatorCorrigido());
        document.getElementById('calcularFatorDesejado').addEventListener('click', () => this.calcularFatorParaDesejado());
        
        // Bot√µes de calibra√ß√£o - Tac√¥metro
        document.getElementById('calibrarMaquinaTacometro').addEventListener('click', () => this.calibrarMaquinaTacometro());
        document.getElementById('adicionarCalibracaoRelatorio').addEventListener('click', () => this.adicionarCalibracaoAoRelatorio());
        document.getElementById('simularFatorDesejado').addEventListener('click', () => this.simularFatorDesejado());
        
        // Bot√µes de relat√≥rios
        document.getElementById('gerarRelatorioCompleto').addEventListener('click', () => this.gerarRelatorioCompleto());
        document.getElementById('exportarExcel').addEventListener('click', () => this.exportarParaExcel());
        document.getElementById('exportarPDF').addEventListener('click', () => this.exportarParaPDF());
        document.getElementById('limparRelatorios').addEventListener('click', () => this.limparRelatorios());
        
        // Bot√µes de hist√≥rico
        document.getElementById('exportarHistoricoExcel').addEventListener('click', () => this.exportarHistoricoExcel());
        document.getElementById('limparHistorico').addEventListener('click', () => this.limparHistorico());
      }
      
      alternarTema() {
        this.temaEscuro = !this.temaEscuro;
        if (this.temaEscuro) {
          document.body.classList.add('dark-theme');
          document.getElementById('themeToggle').textContent = 'üåû';
          localStorage.setItem('temaCalibracaoCompleta', 'escuro');
        } else {
          document.body.classList.remove('dark-theme');
          document.getElementById('themeToggle').textContent = 'üåô';
          localStorage.setItem('temaCalibracaoCompleta', 'claro');
        }
      }
      
      ativarTemaEscuro() {
        this.temaEscuro = true;
        document.body.classList.add('dark-theme');
        document.getElementById('themeToggle').textContent = 'üåû';
      }
      
      ativarAba(abaId) {
        // Desativar todas as abas
        document.querySelectorAll('.tab-content').forEach(aba => {
          aba.classList.remove('active');
        });
        document.querySelectorAll('.tab-btn').forEach(btn => {
          btn.classList.remove('active');
        });
        
        // Ativar aba selecionada
        document.getElementById(abaId).classList.add('active');
        document.querySelector(`.tab-btn[data-tab="${abaId}"]`).classList.add('active');
        
        // Se for a aba de relat√≥rios, atualizar as tabelas
        if (abaId === 'relatorios') {
          this.atualizarTabelaRelatoriosCalibracao();
          this.atualizarTabelaRelatoriosCaboPadrao();
          this.atualizarResumoEstatistico();
        }
        
        // Se for a aba de hist√≥rico, atualizar a tabela
        if (abaId === 'historico') {
          this.atualizarTabelaHistorico();
        }
      }
      
      // ========== FUN√á√ïES DE C√ÅLCULO COM CABO PADR√ÉO ==========
      
      calcularFatorKCaboPadrao() {
        try {
          const comprimentoReal = this.obterValorNumerico('valorPadrao', 'Comprimento Real do Cabo Padr√£o', 0);
          const leituraContador = this.obterValorNumerico('valorContador', 'Leitura do Contador', 0.001);
          
          // Calcular Fator K
          const fatorK = comprimentoReal / leituraContador;
          
          // Calcular metros esperados
          const metrosEsperados = leituraContador * fatorK;
          
          // Calcular erro percentual
          const erroPercentual = Math.abs((metrosEsperados - comprimentoReal) / comprimentoReal) * 100;
          
          // Classifica√ß√£o do erro
          const classificacao = this.classificarErro(erroPercentual);
          
          // Exibir resultados
          document.getElementById('resultadoFatorK').style.display = 'block';
          document.getElementById('valorFatorK').textContent = `Fator K: ${fatorK.toFixed(6)}`;
          document.getElementById('fatorKValor').textContent = fatorK.toFixed(6);
          document.getElementById('comprimentoReal').textContent = `${comprimentoReal.toFixed(3)} m`;
          document.getElementById('leituraContador').textContent = `${leituraContador.toFixed(3)} unidades`;
          document.getElementById('precisaoFatorK').innerHTML = classificacao;
          
          // Adicionar ao hist√≥rico
          this.adicionarHistorico({
            tipo: 'C√°lculo Fator K (Cabo Padr√£o)',
            data: new Date().toLocaleString(),
            valor1: comprimentoReal,
            valor2: leituraContador,
            fatorCalculado: fatorK,
            resultado: `${metrosEsperados.toFixed(3)} m`,
            erroPercentual: erroPercentual
          });
          
          // Adicionar aos relat√≥rios de cabo padr√£o
          this.relatoriosCaboPadrao.push({
            data: new Date().toLocaleString(),
            caboPadrao: comprimentoReal,
            leituraContador: leituraContador,
            fatorK: fatorK,
            metrosCalculados: metrosEsperados,
            erroPercentual: erroPercentual,
            tipo: 'C√°lculo Fator K'
          });
          
          this.salvarDados();
          
          this.mostrarMensagem(`Fator K calculado: ${fatorK.toFixed(6)}`, 'success');
          
        } catch (erro) {
          this.mostrarMensagem(erro.message, 'error');
        }
      }
      
      aplicarFatorCorrigido() {
        try {
          const leituraContador = this.obterValorNumerico('contadorFatorCorrigido', 'Leitura do Contador', 0.001);
          const fatorCorrigido = this.obterValorNumerico('fatorCorrigidoInput', 'Fator K Corrigido', 0);
          
          // Calcular metros corrigidos
          const metrosCorrigidos = leituraContador * fatorCorrigido;
          
          // Exibir resultados
          document.getElementById('resultadoFatorCorrigido').style.display = 'block';
          document.getElementById('metrosCorrigidos').textContent = `${metrosCorrigidos.toFixed(3)} metros`;
          document.getElementById('comprimentoCalculado').textContent = `${metrosCorrigidos.toFixed(3)} m`;
          document.getElementById('fatorAplicado').textContent = fatorCorrigido.toFixed(6);
          
          // Avaliar precis√£o
          let precisao = 'Boa precis√£o';
          if (Math.abs(fatorCorrigido - 1.0) < 0.01) {
            precisao = '<span class="excellent">Excelente precis√£o</span>';
          } else if (Math.abs(fatorCorrigido - 1.0) < 0.05) {
            precisao = '<span class="success-good">Boa precis√£o</span>';
          } else {
            precisao = '<span class="warning-medium">Precis√£o moderada</span>';
          }
          
          document.getElementById('precisaoCorrigida').innerHTML = precisao;
          
          // Adicionar ao hist√≥rico
          this.adicionarHistorico({
            tipo: 'Aplicar Fator Corrigido',
            data: new Date().toLocaleString(),
            valor1: leituraContador,
            valor2: fatorCorrigido,
            resultado: `${metrosCorrigidos.toFixed(3)} m`,
            erroPercentual: null
          });
          
          // Adicionar aos relat√≥rios de cabo padr√£o
          this.relatoriosCaboPadrao.push({
            data: new Date().toLocaleString(),
            caboPadrao: null,
            leituraContador: leituraContador,
            fatorK: fatorCorrigido,
            metrosCalculados: metrosCorrigidos,
            erroPercentual: null,
            tipo: 'Aplicar Fator Corrigido'
          });
          
          this.salvarDados();
          
        } catch (erro) {
          this.mostrarMensagem(erro.message, 'error');
        }
      }
      
      calcularFatorParaDesejado() {
        try {
          const leituraContador = this.obterValorNumerico('contadorDesejado', 'Leitura do Contador', 0.001);
          const metrosDesejados = this.obterValorNumerico('metrosDesejados', 'Metros Desejados', 0);
          
          // Calcular fator necess√°rio
          const fatorNecessario = metrosDesejados / leituraContador;
          
          // Exibir resultados
          document.getElementById('resultadoFatorNecessario').style.display = 'block';
          document.getElementById('fatorNecessario').textContent = fatorNecessario.toFixed(6);
          document.getElementById('metrosAlvo').textContent = `${metrosDesejados.toFixed(3)} m`;
          document.getElementById('contadorBase').textContent = `${leituraContador.toFixed(3)} unidades`;
          
          // Adicionar ao hist√≥rico
          this.adicionarHistorico({
            tipo: 'Calcular Fator para Desejado',
            data: new Date().toLocaleString(),
            valor1: leituraContador,
            valor2: metrosDesejados,
            fatorCalculado: fatorNecessario,
            resultado: `Fator K necess√°rio: ${fatorNecessario.toFixed(6)}`,
            erroPercentual: null
          });
          
          // Adicionar aos relat√≥rios de cabo padr√£o
          this.relatoriosCaboPadrao.push({
            data: new Date().toLocaleString(),
            caboPadrao: null,
            leituraContador: leituraContador,
            fatorK: fatorNecessario,
            metrosCalculados: metrosDesejados,
            erroPercentual: null,
            tipo: 'Fator para Metros Desejados'
          });
          
          this.salvarDados();
          
          this.mostrarMensagem(`Fator necess√°rio: ${fatorNecessario.toFixed(6)}`, 'success');
          
        } catch (erro) {
          this.mostrarMensagem(erro.message, 'error');
        }
      }
      
      limparCamposCaboPadrao() {
        document.getElementById('valorPadrao').value = '';
        document.getElementById('valorContador').value = '';
        document.getElementById('contadorFatorCorrigido').value = '';
        document.getElementById('fatorCorrigidoInput').value = '';
        document.getElementById('contadorDesejado').value = '';
        document.getElementById('metrosDesejados').value = '';
        
        document.getElementById('resultadoFatorK').style.display = 'none';
        document.getElementById('resultadoFatorCorrigido').style.display = 'none';
        document.getElementById('resultadoFatorNecessario').style.display = 'none';
        
        this.mostrarMensagem('Campos do cabo padr√£o limpos!', 'success');
      }
      
      // ========== FUN√á√ïES DE CALIBRA√á√ÉO COM TAC√îMETRO ==========
      
      calibrarMaquinaTacometro() {
        try {
          const fatorAntigo = this.obterValorNumerico('fatorAntigoMaquina', 'Fator Antigo da M√°quina', 0.000001);
          const metrosTacometro = this.obterValorNumerico('metrosTacometroPadrao', 'Medi√ß√£o do Tac√¥metro', 0.001);
          const metrosMaquina = this.obterValorNumerico('metrosMaquinaMedido', 'Medi√ß√£o da M√°quina', 0.001);
          
          // C√ÅLCULO VERIFICADO: Novo fator da m√°quina
          const fatorCorrigido = (fatorAntigo * metrosTacometro) / metrosMaquina;
          
          // Calcular metros com fator antigo
          const metrosComFatorAntigo = (fatorAntigo * metrosMaquina) / fatorAntigo; // Isso √© igual a metrosMaquina
          
          // Calcular metros com fator corrigido (o que a m√°quina mostraria ap√≥s calibra√ß√£o)
          const metrosComFatorCorrigido = (fatorCorrigido * metrosMaquina) / fatorAntigo;
          
          // Calcular erros
          const erroAntigo = Math.abs((metrosComFatorAntigo - metrosTacometro) / metrosTacometro) * 100;
          const erroCorrigido = Math.abs((metrosComFatorCorrigido - metrosTacometro) / metrosTacometro) * 100;
          
          // Calcular melhoria
          const melhoria = erroAntigo - erroCorrigido;
          
          // Classificar status
          let status = 'Pendente';
          let statusHTML = '';
          if (erroCorrigido < 0.1) {
            status = 'Excelente';
            statusHTML = '<span class="excellent">Excelente</span>';
          } else if (erroCorrigido < 1) {
            status = 'Bom';
            statusHTML = '<span class="success-good">Bom</span>';
          } else if (erroCorrigido < 5) {
            status = 'Aceit√°vel';
            statusHTML = '<span class="warning-medium">Aceit√°vel</span>';
          } else {
            status = 'Precisa revis√£o';
            statusHTML = '<span class="error-bad">Precisa revis√£o</span>';
          }
          
          // Exibir resultados
          document.getElementById('resultadoCalibracaoTacometro').style.display = 'block';
          document.getElementById('novoFatorMaquina').textContent = fatorCorrigido.toFixed(6);
          
          document.getElementById('fatorAntigoValor').textContent = fatorAntigo.toFixed(6);
          document.getElementById('fatorCorrigidoTacometro').textContent = fatorCorrigido.toFixed(6);
          document.getElementById('metrosFatorAntigo').textContent = `${metrosComFatorAntigo.toFixed(3)} m`;
          document.getElementById('metrosFatorCorrigido').textContent = `${metrosComFatorCorrigido.toFixed(3)} m`;
          document.getElementById('erroFatorAntigo').textContent = `${erroAntigo.toFixed(2)}%`;
          document.getElementById('erroFatorCorrigido').textContent = `${erroCorrigido.toFixed(2)}%`;
          document.getElementById('melhoriaCalibracao').textContent = `${melhoria.toFixed(2)}%`;
          document.getElementById('statusCalibracao').innerHTML = statusHTML;
          
          // Armazenar dados da calibra√ß√£o atual
          this.calibracaoAtual = {
            data: new Date().toLocaleString(),
            fatorAntigo: fatorAntigo,
            metrosTacometro: metrosTacometro,
            metrosMaquina: metrosMaquina,
            fatorCorrigido: fatorCorrigido,
            metrosFatorAntigo: metrosComFatorAntigo,
            metrosFatorCorrigido: metrosComFatorCorrigido,
            erroAntigo: erroAntigo,
            erroCorrigido: erroCorrigido,
            melhoria: melhoria,
            status: status
          };
          
          this.mostrarMensagem(`M√°quina calibrada! Novo fator: ${fatorCorrigido.toFixed(6)}`, 'success');
          
        } catch (erro) {
          this.mostrarMensagem(erro.message, 'error');
        }
      }
      
      adicionarCalibracaoAoRelatorio() {
        if (!this.calibracaoAtual) {
          this.mostrarMensagem('Primeiro realize uma calibra√ß√£o.', 'error');
          return;
        }
        
        // Adicionar ao array de relat√≥rios de calibra√ß√£o
        this.relatoriosCalibracao.push(this.calibracaoAtual);
        
        // Adicionar ao hist√≥rico
        this.adicionarHistorico({
          tipo: 'Calibra√ß√£o com Tac√¥metro',
          data: this.calibracaoAtual.data,
          valor1: this.calibracaoAtual.fatorAntigo,
          valor2: this.calibracaoAtual.metrosTacometro,
          valor3: this.calibracaoAtual.metrosMaquina,
          fatorCalculado: this.calibracaoAtual.fatorCorrigido,
          resultado: `Novo fator: ${this.calibracaoAtual.fatorCorrigido.toFixed(6)}`,
          erroPercentual: this.calibracaoAtual.erroCorrigido
        });
        
        // Salvar dados
        this.salvarDados();
        
        // Atualizar tabela de relat√≥rios
        this.atualizarTabelaRelatoriosCalibracao();
        
        this.mostrarMensagem('Calibra√ß√£o adicionada ao relat√≥rio!', 'success');
        
        // Limpar calibra√ß√£o atual
        this.calibracaoAtual = null;
        
        // Limpar campos
        document.getElementById('fatorAntigoMaquina').value = '';
        document.getElementById('metrosTacometroPadrao').value = '';
        document.getElementById('metrosMaquinaMedido').value = '';
        document.getElementById('resultadoCalibracaoTacometro').style.display = 'none';
      }
      
      simularFatorDesejado() {
        try {
          const fatorDesejado = this.obterValorNumerico('fatorDesejadoTeste', 'Fator Desejado para Teste', 0);
          const tacometro = this.obterValorNumerico('tacometroTeste', 'Medi√ß√£o do Tac√¥metro', 0.001);
          
          // Usar fator atual do campo ou padr√£o 1.0
          let fatorAtual = parseFloat(document.getElementById('fatorAtualMaquina').value);
          if (isNaN(fatorAtual) || fatorAtual <= 0) {
            fatorAtual = 1.0;
          }
          
          // C√°lculo: Metros que a m√°quina registraria
          const metrosCalculados = (fatorDesejado * tacometro) / fatorAtual;
          
          // Calcular erro
          const erro = Math.abs((metrosCalculados - tacometro) / tacometro) * 100;
          
          // Exibir resultados
          document.getElementById('resultadoSimulacaoTacometro').style.display = 'block';
          document.getElementById('metrosSimuladosTacometro').textContent = `${metrosCalculados.toFixed(3)} metros`;
          document.getElementById('medicaoCalculada').textContent = `${metrosCalculados.toFixed(3)} m`;
          document.getElementById('erroSimulado').textContent = `${erro.toFixed(2)}%`;
          
          // Adicionar ao hist√≥rico
          this.adicionarHistorico({
            tipo: 'Simula√ß√£o com Fator Desejado',
            data: new Date().toLocaleString(),
            valor1: fatorDesejado,
            valor2: tacometro,
            valor3: fatorAtual,
            fatorCalculado: null,
            resultado: `${metrosCalculados.toFixed(3)} m`,
            erroPercentual: erro
          });
          
        } catch (erro) {
          this.mostrarMensagem(erro.message, 'error');
        }
      }
      
      // ========== FUN√á√ïES DE RELAT√ìRIOS ==========
      
      gerarRelatorioCompleto() {
        if (this.relatoriosCalibracao.length === 0 && this.relatoriosCaboPadrao.length === 0) {
          this.mostrarMensagem('Nenhum dado para gerar relat√≥rio.', 'error');
          return;
        }
        
        this.atualizarTabelaRelatoriosCalibracao();
        this.atualizarTabelaRelatoriosCaboPadrao();
        this.atualizarResumoEstatistico();
        this.ativarAba('relatorios');
        
        const total = this.relatoriosCalibracao.length + this.relatoriosCaboPadrao.length;
        this.mostrarMensagem(`Relat√≥rio gerado com ${total} registros.`, 'success');
      }
      
      atualizarTabelaRelatoriosCalibracao() {
        const tabela = document.getElementById('corpoTabelaRelatorios');
        
        if (this.relatoriosCalibracao.length === 0) {
          document.getElementById('linhaSemRelatorios').style.display = 'table-row';
          return;
        }
        
        document.getElementById('linhaSemRelatorios').style.display = 'none';
        
        // Limpar tabela
        tabela.innerHTML = '';
        
        // Adicionar cada relat√≥rio
        this.relatoriosCalibracao.forEach((relatorio, index) => {
          const row = document.createElement('tr');
          
          // Determinar classe CSS para erro
          let classeErroAntigo = '';
          let classeErroCorrigido = '';
          let classeMelhoria = '';
          
          if (relatorio.erroAntigo < 1) classeErroAntigo = 'success-good';
          else if (relatorio.erroAntigo < 5) classeErroAntigo = 'warning-medium';
          else classeErroAntigo = 'error-bad';
          
          if (relatorio.erroCorrigido < 0.1) classeErroCorrigido = 'excellent';
          else if (relatorio.erroCorrigido < 1) classeErroCorrigido = 'success-good';
          else if (relatorio.erroCorrigido < 5) classeErroCorrigido = 'warning-medium';
          else classeErroCorrigido = 'error-bad';
          
          if (relatorio.melhoria > 5) classeMelhoria = 'excellent';
          else if (relatorio.melhoria > 0) classeMelhoria = 'success-good';
          else if (relatorio.melhoria > -1) classeMelhoria = 'warning-medium';
          else classeMelhoria = 'error-bad';
          
          let statusHTML = '';
          if (relatorio.erroCorrigido < 0.1) {
            statusHTML = '<span class="excellent">Excelente</span>';
          } else if (relatorio.erroCorrigido < 1) {
            statusHTML = '<span class="success-good">Bom</span>';
          } else if (relatorio.erroCorrigido < 5) {
            statusHTML = '<span class="warning-medium">Aceit√°vel</span>';
          } else {
            statusHTML = '<span class="error-bad">Precisa revis√£o</span>';
          }
          
          row.innerHTML = `
            <td>${relatorio.data}</td>
            <td>${relatorio.metrosTacometro.toFixed(3)}</td>
            <td>${relatorio.fatorAntigo.toFixed(6)}</td>
            <td>${relatorio.metrosFatorAntigo.toFixed(3)}</td>
            <td><span class="${classeErroAntigo}">${relatorio.erroAntigo.toFixed(2)}%</span></td>
            <td>${relatorio.fatorCorrigido.toFixed(6)}</td>
            <td>${relatorio.metrosFatorCorrigido.toFixed(3)}</td>
            <td><span class="${classeErroCorrigido}">${relatorio.erroCorrigido.toFixed(2)}%</span></td>
            <td><span class="${classeMelhoria}">${relatorio.melhoria.toFixed(2)}%</span></td>
            <td>${statusHTML}</td>
          `;
          
          tabela.appendChild(row);
        });
      }
      
      atualizarTabelaRelatoriosCaboPadrao() {
        const tabela = document.getElementById('corpoTabelaCaboPadrao');
        
        if (this.relatoriosCaboPadrao.length === 0) {
          document.getElementById('linhaSemCaboPadrao').style.display = 'table-row';
          return;
        }
        
        document.getElementById('linhaSemCaboPadrao').style.display = 'none';
        
        // Limpar tabela
        tabela.innerHTML = '';
        
        // Adicionar cada relat√≥rio (apenas os √∫ltimos 20)
        const relatoriosRecentes = this.relatoriosCaboPadrao.slice(-20).reverse();
        
        relatoriosRecentes.forEach(relatorio => {
          const row = document.createElement('tr');
          
          let caboPadraoTexto = relatorio.caboPadrao ? `${relatorio.caboPadrao.toFixed(3)}` : '-';
          let erroHTML = '';
          
          if (relatorio.erroPercentual !== null && relatorio.erroPercentual !== undefined) {
            if (relatorio.erroPercentual < 0.1) {
              erroHTML = `<span class="excellent">${relatorio.erroPercentual.toFixed(2)}%</span>`;
            } else if (relatorio.erroPercentual < 1) {
              erroHTML = `<span class="success-good">${relatorio.erroPercentual.toFixed(2)}%</span>`;
            } else if (relatorio.erroPercentual < 5) {
              erroHTML = `<span class="warning-medium">${relatorio.erroPercentual.toFixed(2)}%</span>`;
            } else {
              erroHTML = `<span class="error-bad">${relatorio.erroPercentual.toFixed(2)}%</span>`;
            }
          } else {
            erroHTML = '-';
          }
          
          row.innerHTML = `
            <td>${relatorio.data}</td>
            <td>${caboPadraoTexto}</td>
            <td>${relatorio.leituraContador ? relatorio.leituraContador.toFixed(3) : '-'}</td>
            <td>${relatorio.fatorK ? relatorio.fatorK.toFixed(6) : '-'}</td>
            <td>${relatorio.metrosCalculados ? relatorio.metrosCalculados.toFixed(3) : '-'}</td>
            <td>${erroHTML}</td>
            <td>${relatorio.tipo}</td>
          `;
          
          tabela.appendChild(row);
        });
      }
      
      atualizarResumoEstatistico() {
        // Estat√≠sticas de calibra√ß√£o
        const totalCalibracoes = this.relatoriosCalibracao.length;
        const calibracoesSucesso = this.relatoriosCalibracao.filter(r => r.erroCorrigido < 1).length;
        
        let melhorMelhoria = 0;
        let mediaErroAntigo = 0;
        let mediaErroCorrigido = 0;
        
        if (totalCalibracoes > 0) {
          melhorMelhoria = Math.max(...this.relatoriosCalibracao.map(r => r.melhoria));
          mediaErroAntigo = this.relatoriosCalibracao.reduce((sum, r) => sum + r.erroAntigo, 0) / totalCalibracoes;
          mediaErroCorrigido = this.relatoriosCalibracao.reduce((sum, r) => sum + r.erroCorrigido, 0) / totalCalibracoes;
        }
        
        // Estat√≠sticas de cabo padr√£o
        const totalCaboPadrao = this.relatoriosCaboPadrao.length;
        
        // Atualizar UI
        document.getElementById('totalCalibracoes').textContent = totalCalibracoes;
        document.getElementById('calibracoesSucesso').textContent = `${calibracoesSucesso} (${totalCalibracoes > 0 ? ((calibracoesSucesso / totalCalibracoes) * 100).toFixed(0) : 0}%)`;
        document.getElementById('melhorMelhoria').textContent = `${melhorMelhoria.toFixed(2)}%`;
        document.getElementById('mediaErroAntigo').textContent = `${mediaErroAntigo.toFixed(2)}%`;
        document.getElementById('mediaErroCorrigido').textContent = `${mediaErroCorrigido.toFixed(2)}%`;
        document.getElementById('totalCaboPadrao').textContent = totalCaboPadrao;
      }
      
      exportarParaExcel() {
        if (this.relatoriosCalibracao.length === 0 && this.relatoriosCaboPadrao.length === 0) {
          this.mostrarMensagem('Nenhum dado para exportar.', 'error');
          return;
        }
        
        // Criar workbook
        const wb = XLSX.utils.book_new();
        const dataHoje = new Date().toISOString().split('T')[0];
        
        // Planilha 1: Calibra√ß√µes com Tac√¥metro
        if (this.relatoriosCalibracao.length > 0) {
          const dadosCalibracao = [
            ['RELAT√ìRIO DE CALIBRA√á√ÉO COM TAC√îMETRO - SOLICAL1', '', '', '', '', '', '', '', '', ''],
            ['Data de Exporta√ß√£o:', new Date().toLocaleString(), '', '', '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', '', '', ''],
            ['Data', 'Tac√¥metro (m)', 'Fator Antigo', 'Medi√ß√£o Antiga (m)', 'Erro Antigo (%)', 
             'Fator Corrigido', 'Medi√ß√£o Corrigida (m)', 'Erro Corrigido (%)', 'Melhoria (%)', 'Status']
          ];
          
          this.relatoriosCalibracao.forEach(relatorio => {
            dadosCalibracao.push([
              relatorio.data,
              relatorio.metrosTacometro.toFixed(3),
              relatorio.fatorAntigo.toFixed(6),
              relatorio.metrosFatorAntigo.toFixed(3),
              relatorio.erroAntigo.toFixed(2) + '%',
              relatorio.fatorCorrigido.toFixed(6),
              relatorio.metrosFatorCorrigido.toFixed(3),
              relatorio.erroCorrigido.toFixed(2) + '%',
              relatorio.melhoria.toFixed(2) + '%',
              relatorio.status
            ]);
          });
          
          const wsCalibracao = XLSX.utils.aoa_to_sheet(dadosCalibracao);
          const wscolsCalibracao = [
            {wch: 20}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15},
            {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 20}
          ];
          wsCalibracao['!cols'] = wscolsCalibracao;
          
          XLSX.utils.book_append_sheet(wb, wsCalibracao, 'Calibra√ß√£o Tac√¥metro');
        }
        
        // Planilha 2: C√°lculos com Cabo Padr√£o
        if (this.relatoriosCaboPadrao.length > 0) {
          const dadosCaboPadrao = [
            ['RELAT√ìRIO DE C√ÅLCULOS COM CABO PADR√ÉO - SOLICAL1', '', '', '', '', '', ''],
            ['Data de Exporta√ß√£o:', new Date().toLocaleString(), '', '', '', '', ''],
            ['', '', '', '', '', '', ''],
            ['Data', 'Cabo Padr√£o (m)', 'Leitura Contador', 'Fator K Calculado', 'Metros Calculados', 'Erro (%)', 'Tipo de C√°lculo']
          ];
          
          this.relatoriosCaboPadrao.forEach(relatorio => {
            const caboPadraoTexto = relatorio.caboPadrao ? relatorio.caboPadrao.toFixed(3) : '-';
            const erroTexto = relatorio.erroPercentual !== null ? relatorio.erroPercentual.toFixed(2) + '%' : '-';
            
            dadosCaboPadrao.push([
              relatorio.data,
              caboPadraoTexto,
              relatorio.leituraContador ? relatorio.leituraContador.toFixed(3) : '-',
              relatorio.fatorK ? relatorio.fatorK.toFixed(6) : '-',
              relatorio.metrosCalculados ? relatorio.metrosCalculados.toFixed(3) : '-',
              erroTexto,
              relatorio.tipo
            ]);
          });
          
          const wsCaboPadrao = XLSX.utils.aoa_to_sheet(dadosCaboPadrao);
          const wscolsCaboPadrao = [
            {wch: 20}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 20}
          ];
          wsCaboPadrao['!cols'] = wscolsCaboPadrao;
          
          XLSX.utils.book_append_sheet(wb, wsCaboPadrao, 'C√°lculos Cabo Padr√£o');
        }
        
        // Planilha 3: Hist√≥rico Completo
        if (this.historico.length > 0) {
          const dadosHistorico = [
            ['HIST√ìRICO COMPLETO DE C√ÅLCULOS - SOLICAL1', '', '', '', '', '', '', ''],
            ['Data de Exporta√ß√£o:', new Date().toLocaleString(), '', '', '', '', '', ''],
            ['', '', '', '', '', '', '', ''],
            ['Data/Hora', 'Tipo', 'Valor 1', 'Valor 2', 'Valor 3', 'Fator Calculado', 'Resultado', 'Erro (%)']
          ];
          
          // Usar apenas os √∫ltimos 100 registros
          const historicoExportar = this.historico.slice(-100);
          
          historicoExportar.forEach(item => {
            const erroTexto = item.erroPercentual !== null ? item.erroPercentual.toFixed(2) + '%' : '-';
            const fatorTexto = item.fatorCalculado ? item.fatorCalculado.toFixed(6) : '-';
            
            dadosHistorico.push([
              item.data,
              item.tipo,
              item.valor1 ? item.valor1.toString() : '-',
              item.valor2 ? item.valor2.toString() : '-',
              item.valor3 ? item.valor3.toString() : '-',
              fatorTexto,
              item.resultado,
              erroTexto
            ]);
          });
          
          const wsHistorico = XLSX.utils.aoa_to_sheet(dadosHistorico);
          const wscolsHistorico = [
            {wch: 20}, {wch: 25}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 30}, {wch: 15}
          ];
          wsHistorico['!cols'] = wscolsHistorico;
          
          XLSX.utils.book_append_sheet(wb, wsHistorico, 'Hist√≥rico');
        }
        
        // Gerar arquivo Excel
        XLSX.writeFile(wb, `relatorio-calibracao-completo-${dataHoje}.xlsx`);
        
        this.mostrarMensagem('Relat√≥rio exportado para Excel com sucesso!', 'success');
      }
      
      exportarParaPDF() {
        if (this.relatoriosCalibracao.length === 0 && this.relatoriosCaboPadrao.length === 0) {
          this.mostrarMensagem('Nenhum dado para exportar.', 'error');
          return;
        }
        
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('landscape');
        
        // T√≠tulo
        doc.setFontSize(20);
        doc.setTextColor(44, 62, 80);
        doc.text('RELAT√ìRIO DE CALIBRA√á√ÉO COMPLETA - SOLICAL1', 20, 20);
        
        doc.setFontSize(12);
        doc.setTextColor(100, 100, 100);
        doc.text(`Data de exporta√ß√£o: ${new Date().toLocaleString()}`, 20, 30);
        
        let yPos = 40;
        
        // Se√ß√£o 1: Calibra√ß√µes com Tac√¥metro
        if (this.relatoriosCalibracao.length > 0) {
          doc.setFontSize(16);
          doc.setTextColor(44, 62, 80);
          doc.text('1. CALIBRA√á√ïES COM TAC√îMETRO', 20, yPos);
          yPos += 10;
          
          const headersCalibracao = [
            ['Data', 'Tac√¥metro (m)', 'Fator Antigo', 'Medi√ß√£o Antiga (m)', 'Erro Antigo (%)', 
             'Fator Corrigido', 'Medi√ß√£o Corrigida (m)', 'Erro Corrigido (%)', 'Melhoria (%)', 'Status']
          ];
          
          const dadosCalibracao = this.relatoriosCalibracao.map(relatorio => [
            relatorio.data,
            relatorio.metrosTacometro.toFixed(3),
            relatorio.fatorAntigo.toFixed(6),
            relatorio.metrosFatorAntigo.toFixed(3),
            relatorio.erroAntigo.toFixed(2) + '%',
            relatorio.fatorCorrigido.toFixed(6),
            relatorio.metrosFatorCorrigido.toFixed(3),
            relatorio.erroCorrigido.toFixed(2) + '%',
            relatorio.melhoria.toFixed(2) + '%',
            relatorio.status
          ]);
          
          doc.autoTable({
            head: headersCalibracao,
            body: dadosCalibracao,
            startY: yPos,
            theme: 'striped',
            headStyles: { fillColor: [44, 62, 80], textColor: 255 },
            alternateRowStyles: { fillColor: [245, 245, 245] },
            margin: { horizontal: 20 },
            styles: { fontSize: 7, cellPadding: 2 }
          });
          
          yPos = doc.lastAutoTable.finalY + 15;
        }
        
        // Se√ß√£o 2: C√°lculos com Cabo Padr√£o
        if (this.relatoriosCaboPadrao.length > 0) {
          // Verificar se precisa de nova p√°gina
          if (yPos > 180) {
            doc.addPage();
            yPos = 20;
          }
          
          doc.setFontSize(16);
          doc.setTextColor(44, 62, 80);
          doc.text('2. C√ÅLCULOS COM CABO PADR√ÉO', 20, yPos);
          yPos += 10;
          
          const headersCaboPadrao = [
            ['Data', 'Cabo Padr√£o (m)', 'Leitura Contador', 'Fator K Calculado', 'Metros Calculados', 'Erro (%)', 'Tipo de C√°lculo']
          ];
          
          const dadosCaboPadrao = this.relatoriosCaboPadrao.slice(-20).map(relatorio => {
            const caboPadraoTexto = relatorio.caboPadrao ? relatorio.caboPadrao.toFixed(3) : '-';
            const erroTexto = relatorio.erroPercentual !== null ? relatorio.erroPercentual.toFixed(2) + '%' : '-';
            
            return [
              relatorio.data,
              caboPadraoTexto,
              relatorio.leituraContador ? relatorio.leituraContador.toFixed(3) : '-',
              relatorio.fatorK ? relatorio.fatorK.toFixed(6) : '-',
              relatorio.metrosCalculados ? relatorio.metrosCalculados.toFixed(3) : '-',
              erroTexto,
              relatorio.tipo
            ];
          });
          
          doc.autoTable({
            head: headersCaboPadrao,
            body: dadosCaboPadrao,
            startY: yPos,
            theme: 'striped',
            headStyles: { fillColor: [52, 73, 94], textColor: 255 },
            alternateRowStyles: { fillColor: [245, 245, 245] },
            margin: { horizontal: 20 },
            styles: { fontSize: 7, cellPadding: 2 }
          });
          
          yPos = doc.lastAutoTable.finalY + 15;
        }
        
        // Se√ß√£o 3: Resumo Estat√≠stico
        if (yPos > 180) {
          doc.addPage();
          yPos = 20;
        }
        
        doc.setFontSize(16);
        doc.setTextColor(44, 62, 80);
        doc.text('3. RESUMO ESTAT√çSTICO', 20, yPos);
        yPos += 15;
        
        const totalCalibracoes = this.relatoriosCalibracao.length;
        const calibracoesSucesso = this.relatoriosCalibracao.filter(r => r.erroCorrigido < 1).length;
        const totalCaboPadrao = this.relatoriosCaboPadrao.length;
        
        doc.setFontSize(12);
        doc.setTextColor(0, 0, 0);
        
        doc.text(`Total de Calibra√ß√µes: ${totalCalibracoes}`, 20, yPos);
        yPos += 8;
        doc.text(`Calibra√ß√µes Bem-sucedidas: ${calibracoesSucesso} (${totalCalibracoes > 0 ? ((calibracoesSucesso / totalCalibracoes) * 100).toFixed(0) : 0}%)`, 20, yPos);
        yPos += 8;
        doc.text(`C√°lculos com Cabo Padr√£o: ${totalCaboPadrao}`, 20, yPos);
        yPos += 8;
        
        if (totalCalibracoes > 0) {
          const melhorMelhoria = Math.max(...this.relatoriosCalibracao.map(r => r.melhoria));
          const mediaErroAntigo = this.relatoriosCalibracao.reduce((sum, r) => sum + r.erroAntigo, 0) / totalCalibracoes;
          const mediaErroCorrigido = this.relatoriosCalibracao.reduce((sum, r) => sum + r.erroCorrigido, 0) / totalCalibracoes;
          
          doc.text(`Melhor Melhoria: ${melhorMelhoria.toFixed(2)}%`, 20, yPos);
          yPos += 8;
          doc.text(`M√©dia de Erro Antigo: ${mediaErroAntigo.toFixed(2)}%`, 20, yPos);
          yPos += 8;
          doc.text(`M√©dia de Erro Corrigido: ${mediaErroCorrigido.toFixed(2)}%`, 20, yPos);
        }
        
        // Rodap√©
        doc.setFontSize(8);
        doc.setTextColor(150, 150, 150);
        doc.text('Relat√≥rio gerado por Calculadora de Calibra√ß√£o Completa - SOLICAL1 | Criado por S√©rgio Carqueij√≥', 
          20, doc.internal.pageSize.height - 10);
        
        // Salvar PDF
        const dataHoje = new Date().toISOString().split('T')[0];
        doc.save(`relatorio-calibracao-completo-${dataHoje}.pdf`);
        
        this.mostrarMensagem('Relat√≥rio exportado para PDF com sucesso!', 'success');
      }
      
      limparRelatorios() {
        if (this.relatoriosCalibracao.length === 0 && this.relatoriosCaboPadrao.length === 0) {
          this.mostrarMensagem('Nenhum relat√≥rio para limpar.', 'info');
          return;
        }
        
        const total = this.relatoriosCalibracao.length + this.relatoriosCaboPadrao.length;
        
        if (confirm(`Tem certeza que deseja limpar todos os ${total} relat√≥rios?`)) {
          this.relatoriosCalibracao = [];
          this.relatoriosCaboPadrao = [];
          this.salvarDados();
          this.atualizarTabelaRelatoriosCalibracao();
          this.atualizarTabelaRelatoriosCaboPadrao();
          this.atualizarResumoEstatistico();
          this.mostrarMensagem('Todos os relat√≥rios foram removidos.', 'success');
        }
      }
      
      // ========== FUN√á√ïES DE HIST√ìRICO ==========
      
      atualizarTabelaHistorico() {
        const tabela = document.getElementById('corpoTabelaHistorico');
        
        if (this.historico.length === 0) {
          document.getElementById('linhaSemHistorico').style.display = 'table-row';
          return;
        }
        
        document.getElementById('linhaSemHistorico').style.display = 'none';
        
        // Limpar tabela
        tabela.innerHTML = '';
        
        // Adicionar cada hist√≥rico (apenas os √∫ltimos 50)
        const historicoRecente = this.historico.slice(-50).reverse();
        
        historicoRecente.forEach(item => {
          const row = document.createElement('tr');
          
          let erroHTML = '';
          if (item.erroPercentual !== null && item.erroPercentual !== undefined) {
            if (item.erroPercentual < 0.1) {
              erroHTML = `<span class="excellent">${item.erroPercentual.toFixed(2)}%</span>`;
            } else if (item.erroPercentual < 1) {
              erroHTML = `<span class="success-good">${item.erroPercentual.toFixed(2)}%</span>`;
            } else if (item.erroPercentual < 5) {
              erroHTML = `<span class="warning-medium">${item.erroPercentual.toFixed(2)}%</span>`;
            } else {
              erroHTML = `<span class="error-bad">${item.erroPercentual.toFixed(2)}%</span>`;
            }
          } else {
            erroHTML = '-';
          }
          
          row.innerHTML = `
            <td>${item.data}</td>
            <td>${item.tipo}</td>
            <td>${item.valor1 ? item.valor1.toString() : '-'}</td>
            <td>${item.valor2 ? item.valor2.toString() : '-'}</td>
            <td>${item.valor3 ? item.valor3.toString() : '-'}</td>
            <td>${item.fatorCalculado ? item.fatorCalculado.toFixed(6) : '-'}</td>
            <td>${item.resultado}</td>
            <td>${erroHTML}</td>
          `;
          
          tabela.appendChild(row);
        });
      }
      
      exportarHistoricoExcel() {
        if (this.historico.length === 0) {
          this.mostrarMensagem('Nenhum dado no hist√≥rico para exportar.', 'error');
          return;
        }
        
        const dados = [
          ['HIST√ìRICO DE C√ÅLCULOS - SOLICAL1', '', '', '', '', '', '', ''],
          ['Data de Exporta√ß√£o:', new Date().toLocaleString(), '', '', '', '', '', ''],
          ['', '', '', '', '', '', '', ''],
          ['Data/Hora', 'Tipo', 'Valor 1', 'Valor 2', 'Valor 3', 'Fator Calculado', 'Resultado', 'Erro (%)']
        ];
        
        // Usar apenas os √∫ltimos 100 registros
        const historicoExportar = this.historico.slice(-100);
        
        historicoExportar.forEach(item => {
          const erroTexto = item.erroPercentual !== null ? item.erroPercentual.toFixed(2) + '%' : '-';
          const fatorTexto = item.fatorCalculado ? item.fatorCalculado.toFixed(6) : '-';
          
          dados.push([
            item.data,
            item.tipo,
            item.valor1 ? item.valor1.toString() : '-',
            item.valor2 ? item.valor2.toString() : '-',
            item.valor3 ? item.valor3.toString() : '-',
            fatorTexto,
            item.resultado,
            erroTexto
          ]);
        });
        
        const ws = XLSX.utils.aoa_to_sheet(dados);
        const wscols = [
          {wch: 20}, {wch: 25}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 15}, {wch: 30}, {wch: 15}
        ];
        ws['!cols'] = wscols;
        
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, 'Hist√≥rico');
        
        const dataHoje = new Date().toISOString().split('T')[0];
        XLSX.writeFile(wb, `historico-calculos-${dataHoje}.xlsx`);
        
        this.mostrarMensagem('Hist√≥rico exportado para Excel com sucesso!', 'success');
      }
      
      limparHistorico() {
        if (this.historico.length === 0) {
          this.mostrarMensagem('Nenhum c√°lculo no hist√≥rico.', 'info');
          return;
        }
        
        if (confirm(`Tem certeza que deseja limpar todo o hist√≥rico (${this.historico.length} c√°lculos)?`)) {
          this.historico = [];
          this.salvarDados();
          this.atualizarTabelaHistorico();
          this.mostrarMensagem('Hist√≥rico limpo com sucesso!', 'success');
        }
      }
      
      // ========== FUN√á√ïES AUXILIARES ==========
      
      adicionarHistorico(dados) {
        this.historico.push(dados);
        
        // Manter apenas os √∫ltimos 200 registros
        if (this.historico.length > 200) {
          this.historico = this.historico.slice(-200);
        }
        
        this.salvarDados();
        this.atualizarTabelaHistorico();
      }
      
      mostrarMensagem(texto, tipo) {
        const mensagem = document.getElementById('message');
        mensagem.textContent = texto;
        mensagem.className = `message ${tipo}`;
        mensagem.style.display = 'block';
        
        setTimeout(() => {
          mensagem.style.display = 'none';
        }, 5000);
      }
      
      obterValorNumerico(id, nome, min) {
        const elemento = document.getElementById(id);
        if (!elemento) {
          throw new Error(`Campo ${nome} n√£o encontrado.`);
        }
        
        const valor = parseFloat(elemento.value);
        if (isNaN(valor)) {
          throw new Error(`Por favor, insira um valor v√°lido para ${nome}.`);
        }
        
        if (valor < min) {
          throw new Error(`${nome} deve ser maior ou igual a ${min}.`);
        }
        
        return valor;
      }
      
      classificarErro(erro) {
        if (erro < 0.1) {
          return '<span class="excellent">Excelente (Erro < 0.1%)</span>';
        } else if (erro < 0.5) {
          return '<span class="success-good">Muito bom (Erro < 0.5%)</span>';
        } else if (erro < 1) {
          return '<span class="success-good">Bom (Erro < 1%)</span>';
        } else if (erro < 2) {
          return '<span class="warning-medium">Aceit√°vel (Erro < 2%)</span>';
        } else if (erro < 5) {
          return '<span class="warning-medium">Moderado (Erro < 5%)</span>';
        } else {
          return '<span class="error-bad">Precisa revis√£o (Erro ‚â• 5%)</span>';
        }
      }
      
      mostrarAjuda() {
        const ajuda = `
          CALCULADORA DE CALIBRA√á√ÉO COMPLETA - AJUDA
        
          üìä ABAS:
          1. CABO PADR√ÉO: Calcular Fator K usando cabo padr√£o e simular corre√ß√µes
          2. CALIBRA√á√ÉO COM TAC√îMETRO: Calibrar m√°quina usando tac√¥metro como padr√£o
          3. RELAT√ìRIOS: Tabelas profissionais com todos os c√°lculos
          4. HIST√ìRICO: Registro completo de todos os c√°lculos
        
          üîß C√ÅLCULOS COM CABO PADR√ÉO:
          - Fator K = Comprimento Real do Cabo Padr√£o √∑ Leitura do Contador
          - Metros Corrigidos = Leitura do Contador √ó Fator K Corrigido
          - Fator Necess√°rio = Metros Desejados √∑ Leitura do Contador
        
          üîß CALIBRA√á√ÉO COM TAC√îMETRO:
          - Novo Fator = (Fator Antigo √ó Medi√ß√£o do Tac√¥metro) √∑ Medi√ß√£o da M√°quina
          - Erro = |(Medi√ß√£o da M√°quina - Medi√ß√£o do Tac√¥metro) √∑ Medi√ß√£o do Tac√¥metro| √ó 100%
          - Melhoria = Erro Antigo - Erro Corrigido
        
          üìà RELAT√ìRIOS:
          - Tabela detalhada com fator antigo, fator corrigido, metros antigos, metros corrigidos, erros e melhoria
          - Exporta√ß√£o para Excel (m√∫ltiplas planilhas) e PDF
          - Resumo estat√≠stico autom√°tico
        
          üíæ DADOS:
          - Hist√≥rico salvo automaticamente (at√© 200 registros)
          - Relat√≥rios persistentes
          - Tema claro/escuro
        
          üìã DICAS:
          1. Sempre use valores positivos
          2. Verifique as unidades (metros para medidas reais)
          3. Ap√≥s calibrar, adicione ao relat√≥rio
          4. Exporte relat√≥rios regularmente para backup
        
          Desenvolvido por S√©rgio Carqueij√≥
          SOLICAL1 - Sistema de Calibra√ß√£o Completo
        `;
        
        alert(ajuda);
      }
      
      atualizarUI() {
        this.atualizarTabelaRelatoriosCalibracao();
        this.atualizarTabelaRelatoriosCaboPadrao();
        this.atualizarTabelaHistorico();
        this.atualizarResumoEstatistico();
      }
    }
    
    // Inicializar a calculadora quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', () => {
      window.calculadora = new CalculadoraCalibracaoCompleta();
      console.log('Calculadora de Calibra√ß√£o Completa pronta!');
    });
  </script>
</body>
</html>